/* eslint-disable */
ï»¿(window.webpackJsonpnxtBundle=window.webpackJsonpnxtBundle||[]).push([["Auth0UniversalLoginAuthSystem"],{286:function(t,e,n){"use strict";n.r(e);var r=n(271),i=n(36),o=n(26),a=n(155),u=n(294),s=n(9),c=n(287),l=n(39),h=n(288),p=n(291),d=n(138),m=n(95),f=n(15),g=n(2),A=n(292),v=function(){function t(){}return t.prototype.getAuth0AccountId=function(){var t=this.getGetterOptions();return A.a.get(g.b.Auth0AccountId,t)},t.prototype.setAuth0AccountId=function(t,e){var n=this.getSetterOptions(e);A.a.set(g.b.Auth0AccountId,t,n)},t.prototype.deleteAuth0AccountId=function(){A.a.delete(g.b.Auth0AccountId,this.getGetterOptions())},t.prototype.getSetterOptions=function(t){return{daysOfLife:t,expandKey:!1,useRootDomain:!0}},t.prototype.getGetterOptions=function(){return{expandKey:!1,useRootDomain:!0}},t}(),y=n(7);n.d(e,"Auth0UniversalLoginAuthSystem",function(){return P});var O,b=(O=function(t,e){return(O=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}O(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}),P=function(n){function t(){var t=n.call(this)||this;t.name="Auth0UniversalLogin",t.id=m.a.Auth0UniversalLogin,t.knownErrMessages={invalidState:"Invalid state"},t.urlParams={returnUrl:{name:"returnUrl",values:void 0},state:{name:"state",values:{refreshTokenFallback:"refreshTokenFallback",continueActivationFlow:"activation",pendingLogout:"logout"}},code:{name:"code",values:void 0},retryFailedLogin:{name:"retryFailedLogin",values:{true:"true"}}},t.repository=new v;var e=o.a.getAuthSettings();if(!t.validateAuthSystemSettings(e))throw a.a.error(t.name,"constructor","Malformed Auth0 client options"),u.a.MALFORMED_AUTH0_OPTIONS;return t.setupAuthOptions(e),t.auth0Client=new r.a(t.auth0Options),t.checkAuthState(),t}return b(t,n),t.prototype.HasActiveSession=function(){var n=this,r="HasActiveSession";if(this.repository.getAuth0AccountId())return this.refreshAccountIdCookie().then(function(){return!0});var t=this.auth0Client.isAuthenticated();return a.a.log(this.name,r,t),t.then(function(e){return e?n.setAuth0AccountIdCookie().then(function(){return n.refreshAuthTokenIfNeeded().then(function(t){return e}).catch(function(t){return a.a.error(n.name,r,"token refresh failed, reason: "+JSON.stringify(t)),n.logout(n.buildReturnUrl([{key:n.urlParams.state.name,value:n.urlParams.state.values.refreshTokenFallback}])),!1})}):Promise.resolve(e)})},t.prototype.showLoginForm=function(t){t&&t.preventDefault();var e=this.auth0Options.redirect_uri;e=f.a.getActivationProcess()?Object(s.c)(e,this.urlParams.returnUrl.name,this.buildReturnUrl([{key:this.urlParams.state.name,value:this.urlParams.state.values.continueActivationFlow}])):Object(s.c)(e,this.urlParams.returnUrl.name,this.buildReturnUrl()),a.a.log(this.name,"showLoginForm","Redirect Url: "+e),this.auth0Client.loginWithRedirect({redirect_uri:e})},t.prototype.showRegisterForm=function(t){this.showLoginForm(t)},t.prototype.logout=function(t){void 0===t&&(t=null);var e=this.auth0Options.redirect_uri;e=Object(s.c)(e,this.urlParams.state.name,this.urlParams.state.values.pendingLogout),e=Object(s.c)(e,this.urlParams.returnUrl.name,t||this.buildReturnUrl()),a.a.log(this.name,"logout","Logout Url: ",e),this.repository.deleteAuth0AccountId(),this.auth0Client.logout({returnTo:e,client_id:this.auth0Options.client_id})},t.prototype.getAuthProfile=function(){var e=this;return this.auth0Client.getUser().then(function(t){return e.mapAuthProfile(t)})},t.prototype.afterSuccessLogin=function(){this.redirectBackToArticle()},t.prototype.afterSuccessRegistration=function(){this.afterSuccessLogin()},t.prototype.setupAuthOptions=function(t){this.auth0Options=t,this.auth0Options.cacheLocation="localstorage"},t.prototype.checkAuthState=function(){var r=this,i="checkAuthState";a.a.log(this.name,i),this.pendingAuthentication()?(a.a.log(this.name,i,"Pending complete auth"),this.completeAuthentication().then(function(){a.a.log(r.name,i,"auth completed"),r.successLogin()}).catch(function(t){if(a.a.error(r.name,i,t.message),t.message==r.knownErrMessages.invalidState)if(Object(s.p)(r.urlParams.retryFailedLogin.name))r.redirectBackToArticle();else{var e=r.auth0Options.redirect_uri,n=Object(s.p)(r.urlParams.returnUrl.name);e=Object(s.c)(e,r.urlParams.retryFailedLogin.name,r.urlParams.retryFailedLogin.values.true),e=Object(s.c)(e,r.urlParams.returnUrl.name,n),r.auth0Client.loginWithRedirect({redirect_uri:e})}})):this.pendingLogout()?(a.a.log(this.name,i,"Pending logout"),this.redirectBackToArticle()):this.pendingActivation()&&(a.a.log(this.name,i,"Pending activation"),this.continueActivation())},t.prototype.pendingAuthentication=function(){return Object(s.s)(this.urlParams.code.name)&&Object(s.s)(this.urlParams.state.name)},t.prototype.pendingLogout=function(){return Object(s.s)(this.urlParams.state.name)&&Object(s.p)(this.urlParams.state.name)==this.urlParams.state.values.pendingLogout},t.prototype.pendingActivation=function(){return Object(s.s)(this.urlParams.state.name)&&Object(s.p)(this.urlParams.state.name)==this.urlParams.state.values.continueActivationFlow},t.prototype.refreshAuthTokenIfNeeded=function(){return this.auth0Options.useRefreshTokens?this.auth0Client.getTokenSilently():Promise.resolve(null)},t.prototype.completeAuthentication=function(){return this.auth0Client.handleRedirectCallback()},t.prototype.continueActivation=function(){window.history.replaceState({},document.title,Object(s.w)(window.location.href,[this.urlParams.state.name]));var e=c.a.subscribe(l.a.Finish,function(){e();var t=c.a.subscribe(l.a.ActivationFormShown,function(){t(),document.getElementsByClassName("connext-activate")[0].parentNode.style.setProperty("z-index","100000001","important")});h.a.get(p.a.ActivationInstance).process()})},t.prototype.redirectBackToArticle=function(){var t=Object(s.p)(this.urlParams.returnUrl.name);window.history.replaceState({},document.title,"/"),window.location.href=t},t.prototype.buildReturnUrl=function(t){void 0===t&&(t=null);var e=window.location.href;return t&&t.length&&t.forEach(function(t){e=Object(s.c)(e,t.key,t.value)}),e},t.prototype.validateAuthSystemSettings=function(t){return null!=t&&null!=t.domain&&null!=t.client_id&&null!=t.redirect_uri},t.prototype.mapAuthProfile=function(t){var e=y.a.getAuthProfile()||{},n=t||{};return{UserId:n.sub||this.repository.getAuth0AccountId(),IdType:d.e.Usual,Email:n.email||e.email,FullName:n.name||n.nickname||e.name||e.nickname||"",AuthSystemData:t}},t.prototype.refreshAccountIdCookie=function(){var e=this;return this.auth0Client.isAuthenticated().then(function(t){if(t)return e.setAuth0AccountIdCookie()})},t.prototype.setAuth0AccountIdCookie=function(){var e=this;return this.auth0Client.getUser().then(function(t){t&&e.repository.setAuth0AccountId(t.sub,o.a.get(p.a.UserAuthenticationTime))})},t}(i.a)}}]);
